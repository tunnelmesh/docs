<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S3-Compatible Storage — TunnelMesh Docs</title>
  <link rel="icon" type="image/png" href="/img/icon.png">
  <meta name="description" content="TunnelMesh includes an S3-compatible object storage service that runs on the coordinator. This provides mesh-only accessible storage - the S3 API is not exposed">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;450;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/base16/monokai.min.css" id="hljs-theme">
  <link rel="stylesheet" href="/css/style.css">
  <script defer src="https://cloud.umami.is/script.js" data-website-id="52ad1994-5bcf-4035-9fc1-98494b14eb2f" data-auto-track="false"></script>
  <link rel="canonical" href="https://read.tunnelmesh.io/docs/s3-storage/">
  <meta property="og:title" content="S3-Compatible Storage — TunnelMesh Docs">
  <meta property="og:description" content="TunnelMesh includes an S3-compatible object storage service that runs on the coordinator. This provides mesh-only accessible storage - the S3 API is not exposed">
  <meta property="og:url" content="https://read.tunnelmesh.io/docs/s3-storage/">
  <meta property="og:type" content="website">
</head>
<body>

<!-- ── Navigation ── -->
<nav class="nav" id="nav">
  <div class="nav-inner">

    <a href="#/docs" class="logo">
      <img src="/img/icon.png" class="logo-img" width="30" height="30" alt="TunnelMesh">
      <span class="logo-word">tunnelmesh</span>
      <span class="logo-tag">docs</span>
    </a>

    <div class="nav-center">
      <button class="nav-tab active" data-view="docs" aria-label="Documentation">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
        </svg>
        Docs
      </button>
      <button class="nav-tab" data-view="blog" aria-label="Blog">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M12 20h9"/>
          <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
        </svg>
        Blog
      </button>
    </div>

    <div class="nav-actions">
      <a href="https://tunnelmesh.io" class="nav-icon-link" target="_blank" rel="noopener" aria-label="TunnelMesh website" title="Website">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="10"/>
          <line x1="2" y1="12" x2="22" y2="12"/>
          <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
        </svg>
      </a>
      <a href="https://github.com/tunnelmesh/tunnelmesh" class="nav-icon-link" target="_blank" rel="noopener" aria-label="GitHub" title="GitHub">
        <svg width="17" height="17" viewBox="0 0 98 96" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z"/>
        </svg>
      </a>
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle light/dark mode">
        <svg class="icon-sun" width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <svg class="icon-moon" width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
    </div>

    <button class="hamburger" id="hamburger" aria-label="Toggle sidebar">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <line x1="3" y1="6" x2="21" y2="6"/>
        <line x1="3" y1="12" x2="21" y2="12"/>
        <line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </button>

  </div>
</nav>

<!-- Mobile overlay -->
<div class="sidebar-overlay" id="sidebar-overlay"></div>

<!-- ── App Layout ── -->
<div class="app-wrap">

  <!-- ══ DOCS VIEW ══ -->
  <div class="view active" id="view-docs">

    <!-- Left sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-scroll">
        <div class="sidebar-section-label">Documentation</div>
        <nav id="sidebar-nav" class="sidebar-nav" aria-label="Documentation navigation"></nav>
      </div>
    </aside>

    <!-- Center content -->
    <main class="docs-main">
      <div class="docs-content">
        <article id="doc-article" class="doc-article" aria-live="polite"><h1 id="s3-compatible-storage">S3-Compatible Storage</h1>
<div class="callout important">
  <div class="callout-title"><span>Important</span></div>
  <div class="callout-body"><p>TunnelMesh includes an S3-compatible object storage service that runs on the coordinator. This provides
<strong>mesh-only accessible</strong> storage - the S3 API is not exposed to the public internet for security.</p></div>
</div>
<p>File shares can also be mounted as network drives via NFS - see the <a href="NFS.md">NFS documentation</a>.</p>
<h2 id="overview">Overview</h2>
<p>The S3 storage service:</p>
<ul>
<li>Is only accessible from within the mesh network</li>
<li>Uses the same authentication as other mesh services</li>
<li>Supports standard S3 API operations</li>
<li>Stores coordinator internal state (users, roles, stats)</li>
</ul>
<h2 id="configuration">Configuration</h2>
<p>S3 is automatically enabled on all coordinators (hardcoded port: 9000).</p>
<p>Optional S3 configuration in coordinator config:</p>
<pre><code class="language-yaml"># S3 is always enabled on coordinators (port 9000, mesh IP only)
coordinator:
  s3:
    max_size: &quot;100Gi&quot;                  # Storage quota (required)
    data_dir: /var/lib/tunnelmesh/s3   # Storage directory
</code></pre>
<h3 id="configuration-options">Configuration Options</h3>
<table>
<thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>max_size</code></td>
<td><code>1Gi</code></td>
<td>Storage quota (e.g., <code>10Gi</code>, <code>500Mi</code>, <code>1Ti</code>)</td>
</tr>
<tr>
<td><code>data_dir</code></td>
<td><code>{data_dir}/s3</code></td>
<td>Directory for object storage</td>
</tr>
<tr>
<td><code>object_expiry_days</code></td>
<td><code>9125</code></td>
<td>Days until objects auto-expire (25 years)</td>
</tr>
<tr>
<td><code>share_expiry_days</code></td>
<td><code>365</code></td>
<td>Days until file shares expire (1 year)</td>
</tr>
<tr>
<td><code>tombstone_retention_days</code></td>
<td><code>90</code></td>
<td>Days to keep soft-deleted items before purge</td>
</tr>
</tbody></table>
<h3 id="size-format">Size Format</h3>
<p>The <code>max_size</code> option accepts Kubernetes-style size notation:</p>
<ul>
<li><code>Ki</code>, <code>Mi</code>, <code>Gi</code>, <code>Ti</code> - binary units (1Ki = 1024 bytes)</li>
<li><code>K</code>, <code>M</code>, <code>G</code>, <code>T</code> - also supported as aliases</li>
<li>Plain numbers are interpreted as bytes</li>
</ul>
<h2 id="api-endpoints">API Endpoints</h2>
<p>The S3 API is available at <code>https://this.tm:9000</code> (or your configured port).</p>
<h3 id="supported-operations">Supported Operations</h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Method</th>
<th>Path</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>ListBuckets</td>
<td>GET</td>
<td><code>/</code></td>
<td>List all buckets</td>
</tr>
<tr>
<td>CreateBucket</td>
<td>PUT</td>
<td><code>/{bucket}</code></td>
<td>Create a bucket</td>
</tr>
<tr>
<td>DeleteBucket</td>
<td>DELETE</td>
<td><code>/{bucket}</code></td>
<td>Delete an empty bucket</td>
</tr>
<tr>
<td>HeadBucket</td>
<td>HEAD</td>
<td><code>/{bucket}</code></td>
<td>Check if bucket exists</td>
</tr>
<tr>
<td>ListObjects</td>
<td>GET</td>
<td><code>/{bucket}</code></td>
<td>List objects in bucket</td>
</tr>
<tr>
<td>ListObjectsV2</td>
<td>GET</td>
<td><code>/{bucket}?list-type=2</code></td>
<td>List objects (V2)</td>
</tr>
<tr>
<td>PutObject</td>
<td>PUT</td>
<td><code>/{bucket}/{key}</code></td>
<td>Upload an object</td>
</tr>
<tr>
<td>GetObject</td>
<td>GET</td>
<td><code>/{bucket}/{key}</code></td>
<td>Download an object</td>
</tr>
<tr>
<td>DeleteObject</td>
<td>DELETE</td>
<td><code>/{bucket}/{key}</code></td>
<td>Delete an object</td>
</tr>
<tr>
<td>HeadObject</td>
<td>HEAD</td>
<td><code>/{bucket}/{key}</code></td>
<td>Get object metadata</td>
</tr>
</tbody></table>
<h3 id="authentication">Authentication</h3>
<div class="callout note">
  <div class="callout-title"><span>Note</span></div>
  <div class="callout-body"><p><strong>Multiple authentication methods supported</strong>: TunnelMesh S3 accepts AWS Signature V4 (standard S3),
Basic Auth (simple), and Bearer Token (access key only). Use whatever your client library supports.</p></div>
</div>
<p>The S3 service supports multiple authentication methods:</p>
<ol>
<li><p><strong>AWS Signature V4</strong> - Standard S3 authentication</p>
<pre><code class="language-text">Authorization: AWS4-HMAC-SHA256 Credential=ACCESS_KEY/...
</code></pre>
</li>
<li><p><strong>Basic Auth</strong> - Simple username/password</p>
<pre><code class="language-text">Authorization: Basic base64(access_key:secret_key)
</code></pre>
</li>
<li><p><strong>Bearer Token</strong> - Access key only</p>
<pre><code class="language-text">Authorization: Bearer access_key
</code></pre>
</li>
</ol>
<h2 id="cli-commands">CLI Commands</h2>
<h3 id="bucket-operations">Bucket Operations</h3>
<pre><code class="language-bash"># Create a bucket
tunnelmesh bucket create my-bucket

# List buckets
tunnelmesh bucket list

# Delete a bucket
tunnelmesh bucket delete my-bucket

# Get bucket info
tunnelmesh bucket info my-bucket
</code></pre>
<h3 id="object-operations">Object Operations</h3>
<pre><code class="language-bash"># Upload a file
tunnelmesh object put my-bucket/path/to/file.txt local-file.txt

# Download a file
tunnelmesh object get my-bucket/path/to/file.txt output.txt

# List objects
tunnelmesh object list my-bucket
tunnelmesh object list my-bucket --prefix docs/

# Delete an object
tunnelmesh object delete my-bucket/path/to/file.txt
</code></pre>
<h2 id="system-bucket">System Bucket</h2>
<div class="callout warning">
  <div class="callout-title"><span>Warning</span></div>
  <div class="callout-body"><p><strong>Reserved bucket</strong>: The <code>_tunnelmesh</code> bucket stores critical coordinator state. Do not delete or
modify it manually. Only service users with the <code>system</code> role can access it.</p></div>
</div>
<p>The coordinator uses a reserved <code>_tunnelmesh</code> bucket for internal state:</p>
<pre><code class="language-text">_tunnelmesh/
  auth/
    users.json      # Registered users
    roles.json      # Custom roles
    bindings.json   # Role bindings
  stats/
    history.json    # Stats history
</code></pre>
<p>This bucket is only accessible to service users with the <code>system</code> role.</p>
<h2 id="file-shares">File Shares</h2>
<p>File shares are user-accessible storage areas backed by S3 buckets. They provide an easy way to share files across the
mesh with automatic permission management.</p>
<h3 id="creating-file-shares">Creating File Shares</h3>
<p>File shares can be created via the admin panel&#39;s Data tab or the API:</p>
<pre><code class="language-bash"># Via API
curl -X POST https://this.tm/api/shares \

  -H &quot;Content-Type: application/json&quot; \
  -d &#39;{&quot;name&quot;: &quot;team-files&quot;, &quot;description&quot;: &quot;Shared team files&quot;, &quot;quota_bytes&quot;: 10737418240}&#39;
</code></pre>
<h3 id="share-properties">Share Properties</h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Name</td>
<td>DNS-safe identifier (alphanumeric + hyphens, max 63 chars)</td>
</tr>
<tr>
<td>Description</td>
<td>Optional description</td>
</tr>
<tr>
<td>Quota</td>
<td>Per-share storage limit (0 = unlimited, max 1TB)</td>
</tr>
<tr>
<td>Owner</td>
<td>Creator gets bucket-admin role automatically</td>
</tr>
<tr>
<td>Expires</td>
<td>Configurable expiry date (or use default from <code>share_expiry_days</code>)</td>
</tr>
<tr>
<td>Guest Read</td>
<td>Allow guest user read access (default: true)</td>
</tr>
</tbody></table>
<h3 id="default-permissions">Default Permissions</h3>
<p>When a file share is created:</p>
<ul>
<li>The creator becomes the owner with <code>bucket-admin</code> role</li>
<li>If &quot;Guest Read&quot; is enabled (default): all mesh users (<code>everyone</code> group) get <code>bucket-read</code> access</li>
<li>If &quot;Guest Read&quot; is disabled: access is controlled entirely via RBAC bindings</li>
<li>Additional permissions can be granted via role bindings in the Data tab</li>
</ul>
<h3 id="accessing-share-contents">Accessing Share Contents</h3>
<p>File shares are backed by S3 buckets with a <code>fs+</code> prefix. Access them via:</p>
<p><strong>S3 API:</strong></p>
<pre><code class="language-bash">aws s3 ls s3://fs+team-files/ --endpoint-url https://this.tm:9000
</code></pre>
<p><strong>NFS Mount:</strong></p>
<pre><code class="language-bash">sudo mount -t nfs this.tm:/team-files /mnt/team-files
</code></pre>
<p><strong>S3 Explorer:</strong> Browse in the admin panel&#39;s Data tab.</p>
<p>See the <a href="NFS.md">NFS documentation</a> for detailed mount instructions.</p>
<h3 id="soft-delete-tombstoning">Soft Delete (Tombstoning)</h3>
<p>Deleted file shares are tombstoned rather than immediately removed:</p>
<ul>
<li>Share data is retained for <code>tombstone_retention_days</code> (default: 90)</li>
<li>Recreating a share with the same name restores the previous content</li>
<li>After the retention period, data is permanently purged</li>
</ul>
<h2 id="using-with-aws-cli">Using with AWS CLI</h2>
<p>Configure the AWS CLI to use your mesh S3:</p>
<pre><code class="language-bash"># Configure credentials
aws configure --profile tunnelmesh
# Enter your access key and secret key

# Set endpoint
export AWS_ENDPOINT_URL=https://this.tm:9000

# List buckets
aws s3 ls --profile tunnelmesh --endpoint-url $AWS_ENDPOINT_URL

# Upload a file
aws s3 cp file.txt s3://my-bucket/file.txt --profile tunnelmesh --endpoint-url $AWS_ENDPOINT_URL
</code></pre>
<h2 id="using-with-sdks">Using with SDKs</h2>
<h3 id="go">Go</h3>
<pre><code class="language-go">import (
    &quot;github.com/aws/aws-sdk-go-v2/aws&quot;
    &quot;github.com/aws/aws-sdk-go-v2/config&quot;
    &quot;github.com/aws/aws-sdk-go-v2/service/s3&quot;
)

cfg, _ := config.LoadDefaultConfig(context.TODO(),
    config.WithCredentialsProvider(credentials.NewStaticCredentialsProvider(
        accessKey, secretKey, &quot;&quot;,
    )),
)

client := s3.NewFromConfig(cfg, func(o *s3.Options) {
    o.BaseEndpoint = aws.String(&quot;https://this.tm:9000&quot;)
    o.UsePathStyle = true
})
</code></pre>
<h3 id="python-boto3">Python (boto3)</h3>
<pre><code class="language-python">import boto3

s3 = boto3.client(&#39;s3&#39;,
    endpoint_url=&#39;https://this.tm:9000&#39;,
    aws_access_key_id=&#39;ACCESS_KEY&#39;,
    aws_secret_access_key=&#39;SECRET_KEY&#39;,
)

# List buckets
response = s3.list_buckets()
</code></pre>
<h2 id="storage-quotas">Storage Quotas</h2>
<p>When <code>max_size</code> is configured, the service enforces storage limits:</p>
<ul>
<li>Object uploads are rejected if quota would be exceeded</li>
<li>Quota is tracked per-bucket and total</li>
<li>Stats available via <code>tunnelmesh bucket info</code></li>
</ul>
<p>Check quota usage:</p>
<pre><code class="language-bash">tunnelmesh storage status
# Output:
# Total: 45.2 GB / 100 GB (45.2%)
# Buckets:
#   my-bucket:     30.1 GB
#   backups:       15.1 GB
</code></pre>
<h2 id="data-persistence">Data Persistence</h2>
<p>All S3 data is stored in the configured <code>data_dir</code>:</p>
<pre><code class="language-text">{data_dir}/
  buckets/
    {bucket}/
      _meta.json           # Bucket metadata
      objects/
        {key}              # Object data
      meta/
        {key}.json         # Object metadata
</code></pre>
<h3 id="backup">Backup</h3>
<div class="callout caution">
  <div class="callout-title"><span>Caution</span></div>
  <div class="callout-body"><p><strong>Backup the data directory</strong>: S3 data is stored on disk, not in a database. Regular backups of the
<code>data_dir</code> are essential. Stop the coordinator before backup to ensure consistency.</p></div>
</div>
<p>To backup S3 data, copy the entire <code>data_dir</code>:</p>
<pre><code class="language-bash"># Stop coordinator first
sudo systemctl stop tunnelmesh

# Backup data
tar -czf s3-backup-$(date +%Y%m%d).tar.gz /var/lib/tunnelmesh/s3

# Restart
sudo systemctl start tunnelmesh
</code></pre>
<h3 id="restore">Restore</h3>
<pre><code class="language-bash">tar -xzf s3-backup.tar.gz -C /
systemctl restart tunnelmesh-server
</code></pre>
<hr>
<p><em>TunnelMesh is released under the <a href="https://github.com/tunnelmesh/tunnelmesh/blob/main/LICENSE">AGPL-3.0 License</a>.</em></p>
</article>
        <nav id="doc-pagination" class="doc-pagination" aria-label="Document navigation"></nav>
      </div>
    </main>

    <!-- Right page TOC -->
    <aside class="page-toc" id="page-toc" aria-label="Page contents">
      <div class="page-toc-label">On this page</div>
      <nav id="page-toc-nav" class="page-toc-nav"></nav>
    </aside>

  </div>

  <!-- ══ BLOG VIEW ══ -->
  <div class="view hidden" id="view-blog">
    <main class="blog-main" id="blog-main" aria-live="polite">
      <div class="doc-loading">
        <div class="loading-spinner"></div>
        <span>Loading…</span>
      </div>
    </main>
  </div>

</div>

<!-- ── Footer ── -->
<footer class="site-footer">
  <p>© 2026 FORGE3D CYF. Registered in Wales, Company No. 16891098.</p>
</footer>

<!-- ── Scripts ── -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/powershell.min.js"></script>
<script src="/js/app.js"></script>
<script>window.__PRERENDERED = {"type":"doc","id":"S3_STORAGE"};</script>
</body>
</html>
